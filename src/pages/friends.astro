---
import { getEntry, render } from "astro:content";
import GiscusComments from "@components/GiscusComments.astro";
import Markdown from "@components/misc/Markdown.astro";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import { Icon } from "astro-icon/components";
import { siteConfig } from "../config";
import { friends } from "../friends_data";

const friendsIntroPost = await getEntry("spec", "friends-intro");
const friendsJoinPost = await getEntry("spec", "friends-join");

if (!friendsIntroPost || !friendsJoinPost) {
	throw new Error("Friends page content not found");
}

const { Content: IntroContent } = await render(friendsIntroPost);
const { Content: JoinContent } = await render(friendsJoinPost);
---

<MainGridLayout title="我的朋友們" description={siteConfig.description}>
    <div class="card-base p-6 md:p-8">
        <div class="sponsors-section mb-8">
            <Markdown class="mt-2 markdown-content">
                <IntroContent />
            </Markdown>
        </div>
        <div class="mb-4">
            <p class="text-sm text-black/60 dark:text-white/60 text-center">
                ✨ 依照申請時間先後排序喔 ✨
            </p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            {friends.map((friend) => (
                <a href={friend.url} target="_blank" rel="noopener noreferrer" class="friend-card">
                    <img src={friend.avatar} loading="lazy" class="friend-avatar" alt={friend.name}>
                    <div class="friend-text">
                        <div class="friend-name">{friend.name}</div>
                        <div class="friend-desc">{friend.description}</div>
                    </div>
                </a>
            ))}
        </div>
        <!-- 申请友链 -->
        <div class="sponsors-section mb-8">
            <Markdown class="mt-2 markdown-content">
                <JoinContent />
            </Markdown>
        </div>



</MainGridLayout>

<style>
.friend-card {
    @apply flex items-center gap-3 p-4 rounded-lg transition;
    background: linear-gradient(135deg, rgba(156, 163, 175, 0.08) 0%, rgba(209, 213, 219, 0.08) 100%);
    border: 1px solid rgba(156, 163, 175, 0.15);
}

.friend-card:hover {
    background: linear-gradient(135deg, rgba(156, 163, 175, 0.12) 0%, rgba(209, 213, 219, 0.12) 100%);
    border-color: rgba(156, 163, 175, 0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.dark .friend-card {
    background: linear-gradient(135deg, rgba(75, 85, 99, 0.12) 0%, rgba(107, 114, 128, 0.12) 100%);
    border-color: rgba(75, 85, 99, 0.25);
}

.dark .friend-card:hover {
    background: linear-gradient(135deg, rgba(75, 85, 99, 0.18) 0%, rgba(107, 114, 128, 0.18) 100%);
    border-color: rgba(75, 85, 99, 0.35);
}

.friend-avatar {
    @apply w-10 h-10 rounded;
}

.friend-text {
    @apply flex flex-col gap-1 min-w-0;
}

.friend-name {
    @apply font-bold text-black dark:text-white;
}

.friend-desc {
    @apply text-sm text-black/50 dark:text-white/50;
}
</style>
