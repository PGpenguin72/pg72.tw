---
import { Icon } from "astro-icon/components";
import { devices, defaultBrand } from "../data/devices";

interface Props {
	title?: string;
	description?: string;
	showHeader?: boolean;
	idPrefix?: string;
}

const {
	title = "我的裝置",
	description = "這裡是我的裝置列表，你可以看到我有啥產品喔:D",
	showHeader = true,
	idPrefix = "device-section",
} = Astro.props;

const brands = Object.keys(devices);
---

<section id={idPrefix} class="card-base p-6 mb-4">
	{showHeader && (
		<div class="mb-6">
			<h1 class="text-3xl font-bold text-90 mb-2">{title}</h1>
			<p class="text-50 text-sm">{description}</p>
		</div>
	)}

	<div class="flex flex-wrap gap-3 mb-8">
		{brands.map((brand) => (
			<button
				type="button"
				data-brand={brand}
				class={`device-tab px-6 py-2.5 rounded-lg font-medium transition-all ${
					brand === defaultBrand ? "btn-regular-dark text-white" : "btn-regular text-75"
				}`}
			>
				{brand}
			</button>
		))}
	</div>

	<div data-devices-container class="grid grid-cols-1 md:grid-cols-2 gap-6">
		{devices[defaultBrand].map((device, index) => (
			<a
				href={device.link}
				target="_blank"
				rel="noopener noreferrer"
				class="device-card card-base card-shadow group relative p-6 transition-all duration-300 onload-animation hover:shadow-xl block cursor-pointer"
				style={`animation-delay: ${index * 100}ms`}
			>
				<div class="flex justify-center items-center h-64 mb-6 bg-[var(--btn-regular-bg)] rounded-xl overflow-hidden">
					<img
						src={device.image}
						alt={device.name}
						class="w-auto h-full object-contain group-hover:scale-105 transition-transform duration-300"
					/>
				</div>

				<div class="text-center">
					<h3 class="text-xl font-bold text-90 mb-2 group-hover:text-[var(--primary)] transition-colors">
						{device.name}
					</h3>
					<div class="flex items-center justify-center gap-2 mb-3">
						<Icon name="material-symbols:info-outline" class="text-lg text-75" />
						<p class="text-75 font-medium">{device.specs}</p>
					</div>
					<p class="text-sm text-50 leading-relaxed mb-3">{device.description}</p>
					<div class="flex items-center justify-center gap-1 text-[var(--primary)] opacity-0 group-hover:opacity-100 transition-opacity">
						<span class="text-sm font-medium">詳細資料</span>
						<Icon name="material-symbols:arrow-forward-rounded" class="text-lg" />
					</div>
				</div>
			</a>
		))}
	</div>
</section>

<script define:vars={{ devices, defaultBrand, idPrefix }}>
	const root = document.getElementById(idPrefix);
	if (root) {
		const brandTabs = root.querySelectorAll(".device-tab");
		const devicesContainer = root.querySelector("[data-devices-container]");

		brandTabs.forEach((tab) => {
			tab.addEventListener("click", () => {
				const brand = tab.dataset.brand;
				if (!brand || !devicesContainer) return;

				brandTabs.forEach((t) => {
					t.classList.remove("btn-regular-dark", "text-white");
					t.classList.add("btn-regular", "text-75");
				});
				tab.classList.add("btn-regular-dark", "text-white");
				tab.classList.remove("btn-regular", "text-75");

				const brandDevices = devices[brand] || [];
				devicesContainer.innerHTML = brandDevices
					.map(
						(device, index) => `
			  <a 
			    href="${device.link}"
			    target="_blank"
			    rel="noopener noreferrer"
			    class="device-card card-base card-shadow group relative p-6 transition-all duration-300 hover:shadow-xl block cursor-pointer"
			    style="animation-delay: ${index * 100}ms; animation: fadeInUp 0.3s ease-out forwards;"
			  >
			    <div class="flex justify-center items-center h-64 mb-6 bg-[var(--btn-regular-bg)] rounded-xl overflow-hidden">
			      <img 
			        src="${device.image}" 
			        alt="${device.name}"
			        class="w-auto h-full object-contain group-hover:scale-105 transition-transform duration-300"
			      />
			    </div>
			    <div class="text-center">
			      <h3 class="text-xl font-bold text-90 mb-2 group-hover:text-[var(--primary)] transition-colors">
			        ${device.name}
			      </h3>
			      <div class="flex items-center justify-center gap-2 mb-3">
			        <svg class="w-5 h-5 text-75" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
			          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
			        </svg>
			        <p class="text-75 font-medium">
			          ${device.specs}
			        </p>
			      </div>
			      <p class="text-sm text-50 leading-relaxed mb-3">
			        ${device.description}
			      </p>
			      <div class="flex items-center justify-center gap-1 text-[var(--primary)] opacity-0 group-hover:opacity-100 transition-opacity">
			        <span class="text-sm font-medium">查看详情</span>
			        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
			          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
			        </svg>
			      </div>
			    </div>
			  </a>
			`,
					)
					.join("");
			});
		});
	}
</script>

<style>
	:global(.device-tab) {
		cursor: pointer;
	}

	:global(.device-card) {
		border: 1px solid var(--line-divider);
	}

	:global(.device-card:hover) {
		border-color: var(--btn-regular-bg-hover);
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
</style>
